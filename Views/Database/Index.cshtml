@{
    ViewData["Title"] = "Database Schema Management";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2><i class="fas fa-database me-2"></i>Database Schema Management</h2>
            <p class="text-muted">Admin-only tools for managing database schema changes</p>

            @if (ViewBag.Success != null)
            {
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>@ViewBag.Success
                </div>
            }

            @if (ViewBag.Error != null)
            {
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>@ViewBag.Error
                </div>
            }

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">
                                <i class="fas fa-wrench me-2"></i>Update Risk Acceptance Schema
                            </h5>
                        </div>
                        <div class="card-body">
                            <p>This will add the new columns needed for the enhanced risk acceptance workflow:</p>
                            <ul class="small">
                                <li>Rename <code>Justification</code> â†’ <code>BusinessNeed</code></li>
                                <li>Add <code>RiskSummary</code></li>
                                <li>Add <code>CurrentCompensatingControls</code></li>
                                <li>Add <code>CurrentRiskLevelWithControls</code></li>
                                <li>Add <code>TreatmentPlan</code></li>
                                <li>Add <code>ProposedCompensatingControls</code></li>
                                <li>Add <code>FutureRiskLevelWithMitigations</code></li>
                                <li>Add <code>CISORecommendation</code></li>
                            </ul>
                            
                            <form asp-action="UpdateRiskAcceptanceSchema" method="post">
                                <button type="submit" class="btn btn-warning" onclick="return confirm('Are you sure you want to update the database schema?')">
                                    <i class="fas fa-database me-2"></i>Update Schema
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-search me-2"></i>Verify Schema
                            </h5>
                        </div>
                        <div class="card-body">
                            <p>Check the current structure of the RiskAcceptanceRequests table.</p>
                            
                            <form asp-action="VerifySchema" method="post">
                                <button type="submit" class="btn btn-info">
                                    <i class="fas fa-table me-2"></i>Show Table Structure
                                </button>
                            </form>

                            @if (ViewBag.Columns != null)
                            {
                                <div class="mt-3">
                                    <h6>Current Table Structure:</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Column Name</th>
                                                    <th>Data Type</th>
                                                    <th>Max Length</th>
                                                    <th>Nullable</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var column in ViewBag.Columns as List<CyberRiskApp.Controllers.DatabaseColumnInfo>)
                                                {
                                                    <tr>
                                                        <td><code>@column.ColumnName</code></td>
                                                        <td>@column.DataType</td>
                                                        <td>@(column.MaxLength?.ToString() ?? "N/A")</td>
                                                        <td>@column.IsNullable</td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>