@model CyberRiskApp.Models.ApplicationDomain
@{
    ViewData["Title"] = "Add New Domain";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
            <i class="fas fa-plus text-success me-2"></i>
            Add New Application Domain
        </h2>
        <a asp-action="Domains" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-1"></i>Back to Domains
        </a>
    </div>

    <form asp-action="Create" method="post">
        @Html.AntiForgeryToken()
        
        <div class="row">
            <div class="col-md-8">
                <!-- Basic Domain Settings -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-globe me-2"></i>Basic Domain Configuration
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="DomainName" class="form-label"></label>
                                    <input asp-for="DomainName" class="form-control" placeholder="example.com" />
                                    <div class="form-text">Enter the fully qualified domain name (FQDN)</div>
                                    <span asp-validation-for="DomainName" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="IsPrimary" class="form-label"></label>
                                    <div class="form-check">
                                        <input asp-for="IsPrimary" class="form-check-input" />
                                        <label asp-for="IsPrimary" class="form-check-label">
                                            Set as primary domain
                                        </label>
                                    </div>
                                    <div class="form-text">The primary domain is the main domain for the application</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label asp-for="Description" class="form-label"></label>
                            <textarea asp-for="Description" class="form-control" rows="3" 
                                      placeholder="Optional description for this domain configuration"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>
                        
                        <div class="form-check">
                            <input asp-for="IsActive" class="form-check-input" checked />
                            <label asp-for="IsActive" class="form-check-label">
                                Domain is active
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Port Configuration -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-network-wired me-2"></i>Port Configuration
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="HttpPort" class="form-label"></label>
                                    <input asp-for="HttpPort" class="form-control" type="number" min="1" max="65535" />
                                    <div class="form-text">Standard HTTP port is 80</div>
                                    <span asp-validation-for="HttpPort" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="HttpsPort" class="form-label"></label>
                                    <input asp-for="HttpsPort" class="form-control" type="number" min="1" max="65535" />
                                    <div class="form-text">Standard HTTPS port is 443</div>
                                    <span asp-validation-for="HttpsPort" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Configuration -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-shield-alt me-2"></i>Security Configuration
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input asp-for="ForceHttps" class="form-check-input" />
                                    <label asp-for="ForceHttps" class="form-check-label">
                                        Force HTTPS redirection
                                    </label>
                                    <div class="form-text">Automatically redirect HTTP requests to HTTPS</div>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input asp-for="EnableHSTS" class="form-check-input" />
                                    <label asp-for="EnableHSTS" class="form-check-label">
                                        Enable HTTP Strict Transport Security (HSTS)
                                    </label>
                                    <div class="form-text">Prevents protocol downgrade attacks</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3" id="hstsSettings" style="display: none;">
                                    <label asp-for="HSTSMaxAge" class="form-label"></label>
                                    <input asp-for="HSTSMaxAge" class="form-control" type="number" min="1" max="31536000" />
                                    <div class="form-text">HSTS maximum age in seconds (1 year = 31,536,000)</div>
                                    <span asp-validation-for="HSTSMaxAge" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Configuration -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-cogs me-2"></i>Advanced Configuration
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="CustomHeaders" class="form-label"></label>
                            <textarea asp-for="CustomHeaders" class="form-control" rows="4" 
                                      placeholder="X-Frame-Options: DENY&#10;X-Content-Type-Options: nosniff&#10;X-XSS-Protection: 1; mode=block"></textarea>
                            <div class="form-text">Custom HTTP headers (one per line). Leave empty for defaults.</div>
                            <span asp-validation-for="CustomHeaders" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <!-- Help Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-question-circle me-2"></i>Help
                        </h5>
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <strong>Primary Domain:</strong> The main domain for your application. Only one domain can be primary.<br><br>
                            
                            <strong>Force HTTPS:</strong> Automatically redirects all HTTP traffic to HTTPS for security.<br><br>
                            
                            <strong>HSTS:</strong> Instructs browsers to only use HTTPS when communicating with your domain.<br><br>
                            
                            <strong>Custom Headers:</strong> Additional security headers to include in HTTP responses.
                        </small>
                    </div>
                </div>

                <!-- Preview Card -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-eye me-2"></i>URL Preview
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="urlPreview">
                            <small class="text-muted">Enter a domain name to see URL preview</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-end mt-4">
            <a asp-action="Domains" class="btn btn-secondary me-2">Cancel</a>
            <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-1"></i>Create Domain
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const hstsCheckbox = document.getElementById('@Html.IdFor(m => m.EnableHSTS)');
            const hstsSettings = document.getElementById('hstsSettings');
            const domainInput = document.getElementById('@Html.IdFor(m => m.DomainName)');
            const httpPortInput = document.getElementById('@Html.IdFor(m => m.HttpPort)');
            const httpsPortInput = document.getElementById('@Html.IdFor(m => m.HttpsPort)');
            const forceHttpsCheckbox = document.getElementById('@Html.IdFor(m => m.ForceHttps)');
            const urlPreview = document.getElementById('urlPreview');

            // Show/hide HSTS settings
            function toggleHSTS() {
                hstsSettings.style.display = hstsCheckbox.checked ? 'block' : 'none';
            }

            // Update URL preview
            function updateUrlPreview() {
                const domain = domainInput.value.trim();
                const httpPort = httpPortInput.value || '80';
                const httpsPort = httpsPortInput.value || '443';
                const forceHttps = forceHttpsCheckbox.checked;

                if (!domain) {
                    urlPreview.innerHTML = '<small class="text-muted">Enter a domain name to see URL preview</small>';
                    return;
                }

                const httpUrl = `http://${domain}${httpPort !== '80' ? ':' + httpPort : ''}`;
                const httpsUrl = `https://${domain}${httpsPort !== '443' ? ':' + httpsPort : ''}`;

                let preview = '<div class="small">';
                if (forceHttps) {
                    preview += `<strong>Primary URL:</strong><br><a href="${httpsUrl}" target="_blank">${httpsUrl}</a><br><br>`;
                    preview += `<strong>HTTP redirects to:</strong><br><span class="text-muted">${httpUrl} → ${httpsUrl}</span>`;
                } else {
                    preview += `<strong>HTTP URL:</strong><br><a href="${httpUrl}" target="_blank">${httpUrl}</a><br><br>`;
                    preview += `<strong>HTTPS URL:</strong><br><a href="${httpsUrl}" target="_blank">${httpsUrl}</a>`;
                }
                preview += '</div>';

                urlPreview.innerHTML = preview;
            }

            // Event listeners
            hstsCheckbox.addEventListener('change', toggleHSTS);
            domainInput.addEventListener('input', updateUrlPreview);
            httpPortInput.addEventListener('input', updateUrlPreview);
            httpsPortInput.addEventListener('input', updateUrlPreview);
            forceHttpsCheckbox.addEventListener('change', updateUrlPreview);

            // Initial setup
            toggleHSTS();
            updateUrlPreview();
        });
    </script>
}

@section Styles {
    <style>
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
        }
        
        .form-text {
            font-size: 0.8rem;
        }
    </style>
}